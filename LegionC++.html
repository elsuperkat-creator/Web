<html class="scroll-smooth" lang="es">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Foro de Creaciones - Tipo Reddit
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-indigo-600 text-white shadow-md sticky top-0 z-50">
   <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
    <h1 class="text-2xl font-semibold flex items-center gap-2">
     <i class="fas fa-palette">
     </i>
     Foro de Creaciones
    </h1>
    <nav class="space-x-4 text-indigo-200">
     <button class="hover:text-white font-semibold" id="btnSortChrono">
      Ordenar por Fecha
     </button>
    </nav>
   </div>
  </header>
  <main class="flex-grow max-w-7xl mx-auto px-4 py-6 w-full">
   <section aria-label="Formulario para subir creación" class="mb-10 bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold mb-4 text-indigo-700">
     Sube tu creación
    </h2>
    <form autocomplete="off" class="space-y-4" id="creationForm">
     <div>
      <label class="block font-medium text-gray-700 mb-1" for="creationName">
       Nombre de la creación
      </label>
      <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="creationName" maxlength="100" name="creationName" placeholder="Ej: Mi pintura digital" required="" type="text"/>
     </div>
     <div>
      <label class="block font-medium text-gray-700 mb-1" for="username">
       Nombre del usuario
      </label>
      <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="username" maxlength="50" name="username" placeholder="Ej: artista123" required="" type="text"/>
     </div>
     <div>
      <label class="block font-medium text-gray-700 mb-1" for="description">
       Descripción
      </label>
      <textarea class="w-full border border-gray-300 rounded-md px-3 py-2 resize-y focus:outline-none focus:ring-2 focus:ring-indigo-500" id="description" maxlength="500" name="description" placeholder="Describe tu creación..." required="" rows="3"></textarea>
     </div>
     <div>
      <label class="block font-medium text-gray-700 mb-1" for="imageUrl">
       URL de la imagen (opcional)
      </label>
      <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="imageUrl" name="imageUrl" placeholder="https://placehold.co/600x400?text=Tu+creacion" type="url"/>
     </div>
     <button class="bg-indigo-600 text-white px-5 py-2 rounded-md font-semibold hover:bg-indigo-700 transition" type="submit">
      Publicar creación
     </button>
    </form>
   </section>
   <section aria-label="Lista de creaciones" class="mb-20">
    <h2 class="text-xl font-semibold mb-6 text-indigo-700">
     Creaciones recientes
    </h2>
    <ul class="space-y-8" id="creationsList">
     <!-- Creaciones se insertan aquí dinámicamente -->
    </ul>
   </section>
  </main>
  <footer class="bg-indigo-600 text-indigo-200 text-center py-4 mt-auto">
   <p>
    © 2025 Foro IDE.
   </p>
  </footer>
  <template id="creationTemplate">
   <li class="bg-white rounded-lg shadow p-6 flex flex-col md:flex-row md:gap-6">
    <img alt="Imagen representativa de la creación subida por el usuario" class="w-full md:w-64 h-40 object-cover rounded-md mb-4 md:mb-0 flex-shrink-0" height="400" src="https://storage.googleapis.com/a1aa/image/b881361a-6cb3-491c-7245-1d89dae9fd43.jpg" width="600"/>
    <div class="flex flex-col flex-grow">
     <div class="flex justify-between items-start">
      <div>
       <h3 class="text-lg font-semibold text-indigo-800">
       </h3>
       <p class="text-sm text-red-600 italic">
       </p>
      </div>
      <time class="text-xs text-red-400">
      </time>
     </div>
     <p class="mt-2 text-red-700 whitespace-pre-wrap">
     </p>
     <section class="mt-4">
      <h4 class="font-semibold text-indigo-700 mb-2">
       Comentarios
      </h4>
      <ul class="commentsList space-y-3 max-h-48 overflow-y-auto pr-2">
      </ul>
      <form autocomplete="off" class="mt-3 flex gap-2">
       <input class="flex-grow border border-red-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" maxlength="300" name="commentInput" placeholder="Escribe un comentario..." required="" type="text"/>
       <button class="bg-indigo-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-indigo-700 transition" type="submit">
        Comentar
       </button>
      </form>
     </section>
    </div>
   </li>
  </template>
  <template id="commentTemplate">
   <li class="bg-gray-100 rounded-md p-3 relative group">
    <p class="commentText text-gray-800 whitespace-pre-wrap">
    </p>
    <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition flex gap-2">
     <button aria-label="Editar comentario" class="editCommentBtn text-indigo-600 hover:text-indigo-800" type="button">
      <i class="fas fa-edit">
      </i>
     </button>
     <button aria-label="Eliminar comentario" class="deleteCommentBtn text-red-600 hover:text-red-800" type="button">
      <i class="fas fa-trash-alt">
      </i>
     </button>
    </div>
   </li>
  </template>
  <script>
   (() => {
      // Estado
      let creations = [];

      // Elementos DOM
      const creationForm = document.getElementById('creationForm');
      const creationsList = document.getElementById('creationsList');
      const creationTemplate = document.getElementById('creationTemplate');
      const commentTemplate = document.getElementById('commentTemplate');
      const btnSortChrono = document.getElementById('btnSortChrono');

      // Función para formatear fecha a string legible
      function formatDate(date) {
        return new Date(date).toLocaleString('es-ES', {
          day: '2-digit',
          month: 'short',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });
      }

      // Guardar en localStorage
      function saveToStorage() {
        localStorage.setItem('creations', JSON.stringify(creations));
      }

      // Cargar desde localStorage
      function loadFromStorage() {
        const data = localStorage.getItem('creations');
        if (data) {
          creations = JSON.parse(data);
        }
      }

      // Crear un nodo de creación
      function createCreationNode(creation) {
        const clone = creationTemplate.content.cloneNode(true);
        const li = clone.querySelector('li');
        const img = clone.querySelector('img');
        const title = clone.querySelector('h3');
        const user = clone.querySelector('p.italic');
        const time = clone.querySelector('time');
        const desc = clone.querySelector('p.mt-2');
        const commentsList = clone.querySelector('ul.commentsList');
        const commentForm = clone.querySelector('form');

        // Rellenar datos
        title.textContent = creation.name;
        user.textContent = `Por: ${creation.username}`;
        time.textContent = formatDate(creation.createdAt);
        desc.textContent = creation.description;

        if (creation.imageUrl && creation.imageUrl.trim() !== '') {
          img.src = creation.imageUrl;
          img.alt = `Imagen subida para la creación llamada ${creation.name} por el usuario ${creation.username}`;
        } else {
          img.src = 'https://placehold.co/600x400?text=Sin+imagen+disponible';
          img.alt = `Imagen por defecto para la creación llamada ${creation.name} sin imagen subida`;
        }

        // Renderizar comentarios
        function renderComments() {
          commentsList.innerHTML = '';
          creation.comments.forEach((comment) => {
            const commentNode = createCommentNode(comment, creation);
            commentsList.appendChild(commentNode);
          });
        }

        renderComments();

        // Añadir comentario
        commentForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const input = commentForm.commentInput;
          const text = input.value.trim();
          if (!text) return;

          const newComment = {
            id: crypto.randomUUID(),
            text,
            createdAt: Date.now(),
          };
          creation.comments.push(newComment);
          saveToStorage();
          renderComments();
          input.value = '';
          input.focus();
        });

        return li;
      }

      // Crear nodo comentario
      function createCommentNode(comment, creation) {
        const clone = commentTemplate.content.cloneNode(true);
        const li = clone.querySelector('li');
        const p = clone.querySelector('p.commentText');
        const btnEdit = clone.querySelector('button.editCommentBtn');
        const btnDelete = clone.querySelector('button.deleteCommentBtn');

        p.textContent = comment.text;

        // Editar comentario
        btnEdit.addEventListener('click', () => {
          // Cambiar p por input
          const input = document.createElement('input');
          input.type = 'text';
          input.value = comment.text;
          input.maxLength = 300;
          input.className =
            'w-full border border-indigo-500 rounded-md px-2 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500';
          li.replaceChild(input, p);
          input.focus();

          // Cambiar botones a guardar y cancelar
          const btnSave = document.createElement('button');
          btnSave.type = 'button';
          btnSave.className =
            'text-green-600 hover:text-green-800 font-semibold px-2';
          btnSave.textContent = 'Guardar';

          const btnCancel = document.createElement('button');
          btnCancel.type = 'button';
          btnCancel.className =
            'text-red-600 hover:text-red-800 font-semibold px-2';
          btnCancel.textContent = 'Cancelar';

          const btnContainer = btnEdit.parentElement;
          btnContainer.innerHTML = '';
          btnContainer.appendChild(btnSave);
          btnContainer.appendChild(btnCancel);

          btnSave.addEventListener('click', () => {
            const newText = input.value.trim();
            if (!newText) {
              alert('El comentario no puede estar vacío.');
              input.focus();
              return;
            }
            comment.text = newText;
            saveToStorage();
            p.textContent = newText;
            li.replaceChild(p, input);
            btnContainer.innerHTML = '';
            btnContainer.appendChild(btnEdit);
            btnContainer.appendChild(btnDelete);
          });

          btnCancel.addEventListener('click', () => {
            li.replaceChild(p, input);
            btnContainer.innerHTML = '';
            btnContainer.appendChild(btnEdit);
            btnContainer.appendChild(btnDelete);
          });
        });

        // Borrar comentario
        btnDelete.addEventListener('click', () => {
          if (
            confirm(
              '¿Estás seguro de que quieres eliminar este comentario? Esta acción no se puede deshacer.'
            )
          ) {
            creation.comments = creation.comments.filter((c) => c.id !== comment.id);
            saveToStorage();
            li.remove();
          }
        });

        return li;
      }

      // Renderizar todas las creaciones
      function renderCreations() {
        creationsList.innerHTML = '';
        creations.forEach((creation) => {
          const node = createCreationNode(creation);
          creationsList.appendChild(node);
        });
      }

      // Ordenar creaciones cronológicamente (más recientes primero)
      function sortCreationsChrono() {
        creations.sort((a, b) => b.createdAt - a.createdAt);
      }

      // Inicializar
      function init() {
        loadFromStorage();
        sortCreationsChrono();
        renderCreations();
      }

      // Evento formulario creación
      creationForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = creationForm.creationName.value.trim();
        const username = creationForm.username.value.trim();
        const description = creationForm.description.value.trim();
        const imageUrl = creationForm.imageUrl.value.trim();

        if (!name || !username || !description) {
          alert('Por favor, completa todos los campos obligatorios.');
          return;
        }

        const newCreation = {
          id: crypto.randomUUID(),
          name,
          username,
          description,
          imageUrl,
          createdAt: Date.now(),
          comments: [],
        };

        creations.unshift(newCreation);
        saveToStorage();
        renderCreations();

        creationForm.reset();
        creationForm.creationName.focus();
      });

      // Botón ordenar cronológicamente
      btnSortChrono.addEventListener('click', () => {
        sortCreationsChrono();
        renderCreations();
      });

      // Ejecutar init
      init();
    })();
  </script>
 </body>
</html>